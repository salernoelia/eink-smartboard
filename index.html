<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Station Board - Z端rich Morgental</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: #fff;
        margin: 0;
        color: #000000;
      }

      .board {
        background-color: #fff;
        border-radius: 8px;
        margin: auto;
        width: 100%;
        padding: 5px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      tr:nth-child(odd) {
        background-color: #979797;
      }

      tr:nth-child(even) {
        background-color: #ffffff;
      }

      th,
      td {
        text-align: left;
        padding: 4px;
        font-size: 30px;
        border-bottom: 1px solid #000000;
      }

      th {
        background-color: #000000;
        color: white;
      }

      h1 {
        color: #000000;
      }

      td.right-align {
        text-align: right;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .right-align {
        text-align: right;
      }

      h3 {
        margin: 0;
        font-size: 28px;
      }
    </style>
  </head>
  <body>
    <script>
      setTimeout(function () {
        window.location.href = "/calendar.html";
      }, 10000);
    </script>
    <div class="board">
      <div class="header">
        <h3>Morgental</h3>
        <h3 id="current-time"></h3>
      </div>
      <table>
        <thead>
          <tr>
            <th>N</th>
            <th>Kat</th>
            <th>Richtung</th>
            <th class="right-align">Abfahrtszeit</th>
          </tr>
        </thead>
        <tbody id="departures-body"></tbody>
      </table>
    </div>
    <script>
      document.getElementById("current-time").textContent =
        new Date().toLocaleString();

      function updateTime() {
        var currentTimeElement = document.getElementById("current-time");
        currentTimeElement.textContent = new Date().toLocaleString([], {
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
      }

      function resolveCategory(categoryCode) {
        var categories = {
          B: "Bus",
          T: "Tram",
          Z: "Zug",
        };
        return categories[categoryCode] || categoryCode;
      }

      function formatTime(dateTimeString) {
        var date = new Date(dateTimeString);
        return date.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function fetchDepartures() {
        var xhr = new XMLHttpRequest();
        xhr.open(
          "GET",
          "http://transport.opendata.ch/v1/stationboard?station=Z端rich+Morgental&limit=12",
          true
        );
        xhr.onload = function () {
          if (xhr.status >= 200 && xhr.status < 400) {
            var departures = JSON.parse(xhr.responseText).stationboard;
            var departuresBody = document.getElementById("departures-body");
            var html = "";
            for (var i = 0; i < departures.length; i++) {
              var destination = departures[i].to.replace("Z端rich, ", "");
              if (
                destination !== "Adliswil, Bahnhof" &&
                destination !== "Neub端hl"
              ) {
                html +=
                  "<tr>" +
                  "<td>" +
                  departures[i].number +
                  "</td>" +
                  "<td>" +
                  resolveCategory(departures[i].category) +
                  "</td>" +
                  "<td>" +
                  destination +
                  "</td>" +
                  '<td class="right-align">' +
                  formatTime(departures[i].stop.departure) +
                  "</td>" +
                  "</tr>";
              }
            }
            departuresBody.innerHTML = html;
          } else {
            console.error("Error fetching departures:", xhr.statusText);
          }
        };
        xhr.onerror = function () {
          console.error("Error fetching departures:", xhr.statusText);
        };
        xhr.send();
      }

      setInterval(updateTime, 1000);
      setInterval(fetchDepartures, 10000);
      fetchDepartures();
    </script>
  </body>
</html>
